---
// Component: src/components/home/About.astro
---

<section class="about-section" id="about-section">
  <h2 class="about-title scroll-target-title">About This Site</h2>
  <div class="about-content scroll-target-content">
    <p>
      This site is currently under construction and is actively being developed, so every time you
      visit, there might be something new!
    </p>
    <p>Here's the pages you can find on this site:</p>
    <ul class="about-nav-list">
      <li>
        <a href="/timeline">Timeline</a>: A record of my experiences, listed chronologically.
      </li>
      <li>
        <a href="/resume">Résumé</a>: My résumé, showcasing my education, experience, skills, and
        awards.
      </li>
      <li>
        <a href="/projects">Projects</a>: A collection of my personal, class, and hobby projects.
      </li>
      <li>
        <a href="/contact">Contact</a>: Get in touch with me through email and social media.
      </li>
    </ul>
  </div>
</section>

<style>
  .about-section {
    padding: 15vh 10%;
    min-height: 70vh;
  }

  .about-title {
    font-size: clamp(2rem, 2rem + 2vw, 4rem);
    font-weight: 600;
    margin-bottom: 1em;
  }

  .about-content {
    font-size: 1.2rem;
    line-height: 1.6;
    max-width: 65ch;
  }

  /* --- Styles for the navigation list --- */
  .about-nav-list {
    list-style: none; /* Remove default bullets */
    padding-left: 0; /* Remove default padding */
    margin-top: 2rem; /* Add some space above the list */
  }

  .about-nav-list li {
    margin-bottom: 1rem; /* Space below each list item, reduced from 1.5rem */
  }
</style>

<script>
  // GSAP Animations specific to the About section
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  function setupAboutAnimations() {
    // Ensure plugin is registered (safe to call multiple times)
    gsap.registerPlugin(ScrollTrigger);

    const pageWrapper = document.querySelector(".page-wrapper");
    if (!pageWrapper) {
      console.warn("About animations setup skipped: page wrapper not found.");
      return;
    }

    const aboutTitle = document.querySelector(".scroll-target-title");
    const aboutContent = document.querySelector(".scroll-target-content");

    // Kill previous triggers for these elements to prevent duplicates
    ScrollTrigger.getAll().forEach((trigger) => {
      if (trigger.trigger === aboutTitle || trigger.trigger === aboutContent) {
        trigger.kill();
        console.log("Killed previous About ScrollTrigger"); // Debug log
      }
    });

    // --- About Title Animation ---
    if (aboutTitle) {
      gsap.set(aboutTitle, { filter: "blur(8px)", opacity: 0 });
      const titleTimeline = gsap.timeline({
        scrollTrigger: {
          trigger: aboutTitle,
          scroller: pageWrapper,
          start: "top 85%",
          end: "bottom 5%",
          scrub: 1,
        },
      });
      titleTimeline
        .to(aboutTitle, { filter: "blur(0px)", opacity: 1, ease: "sine", duration: 2 })
        .to(aboutTitle, { filter: "blur(0px)", opacity: 1, ease: "sine", duration: 2 })
        .to(aboutTitle, { filter: "blur(8px)", opacity: 0, ease: "sine", duration: 1 });
      console.log("Setup About Title ScrollTrigger"); // Debug log
    }

    // --- About Content Animation ---
    if (aboutContent) {
      gsap.set(aboutContent, { opacity: 0, y: 30 });
      const contentTimeline = gsap.timeline({
        scrollTrigger: {
          trigger: aboutContent,
          scroller: pageWrapper,
          start: "top 85%", // 提前触发动画
          end: "bottom 25%", // 提前结束动画
          scrub: 1,
        },
      });
      contentTimeline
        .to(aboutContent, { opacity: 1, y: 0, ease: "power1.inOut", duration: 2 })
        .to(aboutContent, { opacity: 1, y: 0, ease: "power1.inOut", duration: 3 })
        .to(aboutContent, { opacity: 0, y: -30, ease: "power1.inOut", duration: 2 });
      console.log("Setup About Content ScrollTrigger"); // Debug log
    }
  }

  // Run setup on initial load and after SPA navigations
  document.addEventListener("astro:page-load", setupAboutAnimations, { once: false });
</script>
